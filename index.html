<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IVEå°ç»„ - WebGISè¯¾ç¨‹ä½œä¸šå±•ç¤º</title>
    <style>
        /* --- å…¨å±€æ ·å¼ --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- å¼€åœºåŠ¨ç”»å±‚ --- */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #12513D; z-index: 9999;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            color: white; animation: slideUp 1s ease-in-out 2.5s forwards;
        }
        .intro-text { font-size: 3rem; font-weight: bold; opacity: 0; letter-spacing: 5px; animation: fadeIn 1.5s ease-in-out 0.5s forwards; }
        .intro-sub { font-size: 1.2rem; margin-top: 20px; opacity: 0; color: #C3DCC4; animation: fadeIn 1.5s ease-in-out 1s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { 0% { transform: translateY(0); } 100% { transform: translateY(-100%); } }

        /* --- ä¸»å†…å®¹ --- */
        .main-container {
            padding-top: 50px;
            display: flex; flex-direction: column; align-items: center;
            opacity: 0; animation: showContent 1s ease-in-out 3s forwards;
        }
        @keyframes showContent { to { opacity: 1; } }

        .team-title {
            font-size: 2.5rem; color: #12513D; margin-bottom: 3rem;
            text-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .cards-wrapper {
            display: flex; gap: 30px; flex-wrap: wrap; justify-content: center;
            padding: 0 20px 50px 20px; width: 100%; max-width: 1200px;
        }

        /* æˆå‘˜å¡ç‰‡ */
        .member-card {
            width: 220px; height: 300px; background: white; border-radius: 15px;
            text-decoration: none; color: #333; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease; display: flex; flex-direction: column;
            align-items: center; overflow: hidden; position: relative; cursor: pointer;
        }
        .member-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(18, 81, 61, 0.3); }

        .card-img { width: 100%; height: 70%; object-fit: cover; border-bottom: 4px solid #12513D; }
        .card-info { height: 30%; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .name { font-size: 1.2rem; font-weight: bold; color: #12513D; margin-bottom: 5px; }
        .role { font-size: 0.9rem; color: #666; text-align: center; padding: 0 5px; }

        /* ç®¡ç†æŒ‰é’® */
        .admin-btn {
            position: fixed; bottom: 20px; right: 20px;
            background: #12513D; color: white; padding: 10px 20px; border-radius: 30px;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 1000;
            border: none; font-weight: bold; transition: all 0.3s;
        }
        .admin-btn:hover { background: #0e3f30; transform: scale(1.05); }

        /* åˆ é™¤æŒ‰é’® (é»˜è®¤éšè—) */
        .delete-btn {
            position: absolute; top: 10px; right: 10px;
            background: red; color: white; width: 25px; height: 25px; border-radius: 50%;
            text-align: center; line-height: 25px; cursor: pointer; display: none;
            font-weight: bold; z-index: 10;
        }

        /* æ·»åŠ æˆå‘˜å¼¹çª— */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 10px; width: 320px;
            display: flex; flex-direction: column; gap: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .modal h3 { color: #12513D; text-align: center; margin-bottom: 10px; }
        .modal input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        .modal button { padding: 10px; background: #12513D; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .modal button:hover { background: #0e3f30; }
        .modal .cancel { background: #999; }
        .modal .cancel:hover { background: #777; }
    </style>
</head>
<body>

    <div id="intro-overlay">
        <div class="intro-text">aespa å°ç»„</div>
        <div class="intro-sub">WebGIS è¯¾ç¨‹é¡¹ç›®å±•ç¤º</div>
    </div>

    <div class="main-container">
        <h1 class="team-title">æ¬¢è¿è®¿é—® IVE å°ç»„ä¸»é¡µ</h1>
        
        <div class="cards-wrapper" id="members-container">
            <p style="font-size: 1.2rem; color: #666;">æ­£åœ¨è¿æ¥äº‘ç«¯æ•°æ®åº“...</p>
        </div>
    </div>

    <button class="admin-btn" onclick="toggleAdminMode()">ğŸ”§ ç®¡ç†æˆå‘˜</button>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <h3>æ·»åŠ æ–°æˆå‘˜</h3>
            <input type="text" id="newName" placeholder="å§“å (å¦‚: ç‹äº”)">
            <input type="text" id="newRole" placeholder="è§’è‰² (å¦‚: å‰ç«¯å¼€å‘)">
            <input type="text" id="newAvatar" placeholder="å¤´åƒè·¯å¾„ (å¦‚: image/ç‹äº”.jpg)">
            <input type="text" id="newLink" placeholder="ä¸»é¡µæ–‡ä»¶å (å¦‚: wangwu.html)">
            <button onclick="submitNewMember()">ç¡®è®¤æ·»åŠ </button>
            <button class="cancel" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        const RENDER_HOST = "https://webgisproject.onrender.com"; // ä½ çš„åç«¯åœ°å€
        let isAdmin = false;

        // åŠ è½½æˆå‘˜åˆ—è¡¨
        async function loadMembers() {
            const container = document.getElementById('members-container');
            try {
                const res = await fetch(`${RENDER_HOST}/members`);
                if (!res.ok) throw new Error("æœåŠ¡å™¨æœªå“åº”");
                const members = await res.json();
                
                container.innerHTML = ''; // æ¸…ç©ºæç¤º

                if (members.length === 0) {
                    container.innerHTML = '<p>æš‚æ— æˆå‘˜ï¼Œè¯·ç‚¹å‡»å³ä¸‹è§’æ·»åŠ ã€‚</p>';
                    return;
                }

                members.forEach(m => {
                    const card = document.createElement('div');
                    card.className = 'member-card';
                    
                    // ç‚¹å‡»å¡ç‰‡è·³è½¬é€»è¾‘ (å¦‚æœæ˜¯ç‚¹å‡»åˆ é™¤æŒ‰é’®ï¼Œåˆ™ä¸è·³è½¬)
                    card.onclick = (e) => {
                        if(e.target.className !== 'delete-btn') {
                            window.location.href = m.page_link;
                        }
                    };

                    card.innerHTML = `
                        <div class="delete-btn" onclick="deleteMember(${m.id})">Ã—</div>
                        <img src="${m.avatar}" alt="${m.name}" class="card-img" onerror="this.src='https://via.placeholder.com/220x200?text=No+Image'">
                        <div class="card-info">
                            <span class="name">${m.name}</span>
                            <span class="role">${m.role}</span>
                        </div>
                    `;
                    container.appendChild(card);
                });
                
                updateAdminState(); // ä¿æŒåˆ é™¤æŒ‰é’®çš„çŠ¶æ€

            } catch (err) {
                console.error(err);
                container.innerHTML = `<p style="color:red; text-align:center;">åŠ è½½å¤±è´¥ã€‚<br>è¯·æ£€æŸ¥åç«¯ Render æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚<br><small>${err.message}</small></p>`;
            }
        }

        // åˆ‡æ¢ç®¡ç†æ¨¡å¼
        function toggleAdminMode() {
            isAdmin = !isAdmin;
            const btn = document.querySelector('.admin-btn');
            
            if (isAdmin) {
                btn.textContent = "â• æ·»åŠ æˆå‘˜";
                btn.onclick = openModal; // æŒ‰é’®åŠŸèƒ½å˜ä¸ºæ‰“å¼€å¼¹çª—
                // æ˜¾ç¤ºæ‰€æœ‰åˆ é™¤æŒ‰é’®
                document.querySelectorAll('.delete-btn').forEach(b => b.style.display = 'block');
            } else {
                // é€€å‡ºç®¡ç†æ¨¡å¼ï¼Œåˆ·æ–°é¡µé¢æ¢å¤åˆå§‹çŠ¶æ€æœ€ç®€å•
                location.reload();
            }
        }

        function updateAdminState() {
            if(isAdmin) {
                document.querySelectorAll('.delete-btn').forEach(b => b.style.display = 'block');
            }
        }

        // å¼¹çª—æ§åˆ¶
        function openModal() { document.getElementById('addModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('addModal').style.display = 'none'; }

        // æäº¤æ–°æˆå‘˜
        async function submitNewMember() {
            const name = document.getElementById('newName').value;
            const role = document.getElementById('newRole').value;
            const avatar = document.getElementById('newAvatar').value;
            const page_link = document.getElementById('newLink').value;

            if(!name || !page_link) return alert('å§“åå’Œä¸»é¡µé“¾æ¥å¿…å¡«');

            const data = { name, role, avatar, page_link };

            try {
                const res = await fetch(`${RENDER_HOST}/addmember`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if(res.ok) {
                    alert('æ·»åŠ æˆåŠŸ');
                    closeModal();
                    loadMembers(); // åˆ·æ–°åˆ—è¡¨
                } else {
                    alert('æ·»åŠ å¤±è´¥');
                }
            } catch (err) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }

        // åˆ é™¤æˆå‘˜
        async function deleteMember(id) {
            if(!confirm('ç¡®å®šè¦åˆ é™¤è¯¥æˆå‘˜å—ï¼Ÿ')) return;
            try {
                const res = await fetch(`${RENDER_HOST}/deletemember`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({id})
                });
                if(res.ok) {
                    loadMembers(); // åˆ·æ–°
                } else {
                    alert('åˆ é™¤å¤±è´¥');
                }
            } catch (err) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }

        // åˆå§‹åŒ–ï¼šåŠ è½½æˆå‘˜
        // å»¶æ—¶ä¸€ç‚¹ç‚¹æ˜¯ä¸ºäº†é…åˆå¼€åœºåŠ¨ç”»ï¼Œé¿å…è¯·æ±‚å¤ªå¿«
        setTimeout(loadMembers, 500);

        // åŠ¨ç”»ç»“æŸåå…è®¸æ»šåŠ¨
        setTimeout(function() {
            document.body.style.overflow = 'auto';
        }, 3500);
    </script>
</body>
</html>
